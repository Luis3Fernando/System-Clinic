{% extends 'generic-recepcion.html' %}

{% block title %}Citas{% endblock %}
{% block extra_css %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles/recepcion/form-citas.css' %}">
{% endblock %}

{% block cita_active %}active{% endblock %}

{% block cita_icon %}
<img src="{% static 'icon/cita-color.png' %}" alt="cita">
{% endblock %}

{% block content %}

    <div class="container-form">
        <h1>Crear Cita</h1>
        <form method="POST" action="{% url 'agregar-cita' %}" class="cita-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="paciente">Paciente</label>
                <input type="text" id="paciente-search" class="form-control" placeholder="Buscar paciente...">
                <select name="paciente" id="paciente" class="form-control" size="5" required>
                    <!-- Opciones se llenarán dinámicamente con JavaScript -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="doctor">Doctor</label>
                <select name="doctor" id="doctor" class="form-control">
                    {% for doctor in doctores %}
                    <option value="{{ doctor.id }}">{{ doctor.nombre }} {{ doctor.apellidos }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="servicio">Servicio</label>
                <select name="servicio" id="servicio" class="form-control">
                    {% for servicio in servicios %}
                    <option value="{{ servicio.id }}">{{ servicio.nombre }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="fecha">Fecha</label>
                        <input type="date" id="fecha" name="fecha" class="form-control" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="hora_inicio">Hora de inicio</label>
                        <input type="time" id="hora_inicio" name="hora_inicio" class="form-control" required>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="hora_fin">Hora de fin</label>
                        <input type="time" id="hora_fin" name="hora_fin" class="form-control" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="motivo">Motivo</label>
                        <textarea id="motivo" name="motivo" class="form-control" rows="3"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="notas">Notas</label>
                <textarea id="notas" name="notas" class="form-control" rows="5"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary">Crear Cita</button>
        </form>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('paciente-search');
        const pacienteSelect = document.getElementById('paciente');
        
        searchInput.addEventListener('input', () => {
            const query = searchInput.value;
            fetch(`/recepcion/search-pacientes/?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    pacienteSelect.innerHTML = ''; // Clear previous options
                    data.pacientes.forEach(paciente => {
                        const option = document.createElement('option');
                        option.value = paciente.id;
                        option.textContent = `${paciente.nombre} ${paciente.apellidos}`;
                        pacienteSelect.appendChild(option);
                    });
                });
        });
    });
</script>
{% endblock %}